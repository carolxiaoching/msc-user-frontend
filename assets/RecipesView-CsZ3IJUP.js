import{L as E,m as G,e as Q,s as V,f as v,D as H,j as n,l as s,p as c,t as I,v as J,x as W,y as r,q as d,F as w,M as x,z as u,S as C,Q as f,n as F,R as X,u as Y,k as l,N as Z}from"./index-DVzcaiEy.js";import{_ as ee}from"./CardComponent-CCMDrMd-.js";import{_ as se}from"./PaginationComponent-5ffXuQcN.js";import{t as te}from"./tagAndCategoryStore-BIILi7YE.js";const ae={class:"py-17"},oe={class:"recipesBanner mx-auto mb-17 rounded-2"},ne={class:"recipesBannerOverLay d-flex justify-content-center align-items-center position-absolute top-0 bottom-0 start-0 end-0 p-8"},le={class:"recipesBannerContent text-center text-white"},re={class:"input-group"},ie={class:"row"},ce={class:"col-12 col-xl-3"},de={class:"sidebarList"},ue={class:""},ge=["onClick"],pe={class:"sidebarTags"},ye=["onClick"],ve={class:"col-12 col-xl-9 d-flex flex-column"},fe={class:"d-flex mb-14"},ke={key:0,class:"toolbarFilterText me-4"},me={key:1,class:"toolbarFilterTags"},be={class:"toolbarSort ms-auto"},_e={key:0,class:"flex-fill d-flex justify-content-center align-items-center me-4"},he={key:1,class:"row row-cols-1 row-cols-md-2 row-cols-xxl-3 gy-14 mb-11"},we={key:2,class:"mt-14"},Le={__name:"RecipesView",setup(xe){const g=X(),k=Y(),M=E(),N=G(),T=Q(),q=te(),{openLoading:A,closeLoading:R}=M,{pushMessage:L}=N,{getTagsAndCategories:P}=q,{toggleCollect:j}=T,{myProfile:D}=V(T),{categories:m,tags:b}=V(q),p=v([]),_=v({}),o=v({sort:"desc",category:"全部",keyword:"",tags:[],page:1}),y=v("");function i(a){o.value={...o.value,...a},B()}H(()=>g.query,async a=>{if(a){(!b.value.length||!m.value.length)&&await P();const{keyword:e,category:t}=g.query;(e||t)&&(o.value={sort:"desc",category:t||"全部",keyword:e||"",tags:[],page:1}),B()}},{immediate:!0});async function S(){g.query.keyword&&k.replace("/recipes");const e=y.value.trim();if(!e){L({style:"warning",title:"請輸入關鍵字",text:"請輸入關鍵字"});return}i({keyword:e,category:"全部",tags:[],page:1}),y.value=""}async function z(){g.query.keyword&&k.replace("/recipes"),i({keyword:"",category:"全部",tags:[],page:1})}function $(a){g.query.category&&k.replace("/recipes"),i({category:a})}function K(a){const e=o.value.tags||[];if(e.length>=3&&!e.includes(a)){L({style:"warning",title:"標籤數量限制",text:"最多只能選擇3個標籤"});return}const t=e.indexOf(a);t>-1?e.splice(t,1):e.push(a),i({tags:e,page:1})}function h(a){i({sort:a,page:1})}function O(a){i({page:a})}async function B(){var a,e;A();try{const t=await Z(o.value);p.value=t.data.data.results,_.value=t.data.data.pagination,R()}catch(t){message.pushMessage({style:"danger",title:"取得食譜列表失敗",text:((e=(a=t.response)==null?void 0:a.data)==null?void 0:e.message)||"請重整網頁再試一次"}),R()}}return(a,e)=>(l(),n("div",ae,[s("div",oe,[s("div",ne,[s("div",le,[e[5]||(e[5]=s("h2",{class:"recipesBannerTitle mb-14 lh-base"},[c(" 美味相伴 "),s("span",{class:"d-block"},"讓忙碌的生活更有滋味")],-1)),s("div",re,[I(s("input",{type:"text",class:"form-control",placeholder:"請輸入關鍵字","aria-label":"請輸入關鍵字","aria-describedby":"search","onUpdate:modelValue":e[0]||(e[0]=t=>y.value=t),onKeyup:W(S,["enter"])},null,544),[[J,y.value]]),s("button",{class:"btn btn-secondary",type:"button",id:"search",onClick:r(S,["prevent"])}," 搜尋 ")])])])]),s("div",ie,[s("div",ce,[e[6]||(e[6]=s("h5",{class:"sidebarTitle"},"分類",-1)),s("ul",de,[s("li",ue,[s("a",{href:"#",class:d(["sidebarLink",{active:o.value.category=="全部"}]),onClick:e[1]||(e[1]=r(t=>$("全部"),["prevent"]))}," 全部 ",2)]),(l(!0),n(w,null,x(u(m),t=>(l(),n("li",{class:"",key:t._id},[s("a",{href:"#",class:d(["sidebarLink",{active:o.value.category==t._id}]),onClick:r(U=>$(t._id),["prevent"])},f(t.title),11,ge)]))),128))]),e[7]||(e[7]=s("h5",{class:"sidebarTitle"},[c(" 標籤 "),s("span",{class:"text-dark-emphasis fs-6"},"( 只能選3個 )")],-1)),s("ul",pe,[(l(!0),n(w,null,x(u(b),t=>(l(),n("li",{key:t._id},[s("a",{href:"#",class:d(["sidebarTagsLink",{sidebarTagsLinkActive:o.value.tags.includes(t._id)}]),onClick:r(U=>K(t._id),["prevent"])},f(t.title),11,ye)]))),128))])]),s("div",ve,[s("div",fe,[o.value.keyword!==""?(l(),n("div",ke,[s("a",{href:"#",class:"badge text-bg-primary fs-6",onClick:r(z,["prevent"])},[c(f(o.value.keyword)+" ",1),e[8]||(e[8]=s("i",{class:"bi bi-x"},null,-1))])])):C("",!0),o.value.keyword!==""?(l(),n("div",me," 共 "+f(p.value.length)+" 筆 ",1)):C("",!0),s("div",be,[s("a",{href:"#",class:d(["me-8",{"link-secondary":o.value.sort==="desc"}]),onClick:e[2]||(e[2]=r(t=>h("desc"),["prevent"]))},e[9]||(e[9]=[s("span",null,[s("i",{class:"bi bi-arrow-down"}),c(" 新到舊 ")],-1)]),2),s("a",{href:"#",class:d(["me-8",{"link-secondary":o.value.sort==="asc"}]),onClick:e[3]||(e[3]=r(t=>h("asc"),["prevent"]))},e[10]||(e[10]=[s("span",null,[s("i",{class:"bi bi-arrow-up"}),c(" 舊到新 ")],-1)]),2),s("a",{href:"#",class:d({"link-secondary":o.value.sort==="hot"}),onClick:e[4]||(e[4]=r(t=>h("hot"),["prevent"]))},e[11]||(e[11]=[s("span",null,[s("i",{class:"bi bi-fire"}),c(" 熱門度 ")],-1)]),2)])]),p.value.length===0?(l(),n("div",_e,e[12]||(e[12]=[s("p",{class:"fs-3 text-dark-emphasis"},[s("em",null,"沒有符合條件的食譜")],-1)]))):(l(),n("div",he,[(l(!0),n(w,null,x(p.value,t=>(l(),n("div",{class:"col",key:t._id},[F(ee,{recipe:t,categories:u(m),tags:u(b),collects:u(D).collects,onToggleCollect:u(j),mode:"collect"},null,8,["recipe","categories","tags","collects","onToggleCollect"])]))),128))])),_.value.totalPage?(l(),n("div",we,[F(se,{pagination:_.value,onUpdatePage:O},null,8,["pagination"])])):C("",!0)])])]))}};export{Le as default};
